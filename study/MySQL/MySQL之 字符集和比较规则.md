# Table of Contents

* [MySQL之 字符集和比较规则](#mysql之-字符集和比较规则)
    * [准备](#准备)
    * [字符集解惑](#字符集解惑)
    * [比较规则解惑](#比较规则解惑)
    * [字符集和比较规则设置解惑](#字符集和比较规则设置解惑)
    * [参考](#参考)


# MySQL之 字符集和比较规则

## 准备

本文会涉及以下2个重点：

1. 字符集解惑
2. 比较规则解惑
3. 字符集和比较规则设置解惑

## 字符集解惑

数据体现到网络传输和底层存储，最终形式都是二进制（也就是一串0、1），但是我们人可知的是字符，也就是说字符和二进制码之间是有转换的。

字符->二进制码称为**编码**，二进制码->字符称为**解码**，既然涉及到转换，那自然就会有一套规则，**字符集**就是这么个概念，定义了一组字符、二进制码转换的规则。

既然规则是人定的，所以就有了很多**字符集**，常见的：

1. ASCII
2. ISO 8859-1
3. GB2312
4. GBK
5. utf8
6. ...

不要被这么多**字符集**搞晕了，它们单纯的就是规则而已，比如 ASCII 不支持汉字，但在 GB2312 等中就支持了，甚至 utf8 尽可能的在收录所有可知字符。

在MySQL中最常用的就是 utf8 ，但这里的 utf8 是阉割过的，另一个 utf8mb4 才是标准意义上的 utf8：

- utf8（utf8mb3）：MySQL阉割过的 utf8 字符集，只表示1~3个字节
- utf8mb4：标准意义的 utf8，表示1~4个字节

至于为什么要阉割，**典型答案**：

一个字符的最大长度会影响存储和性能，限制成最长3个字节虽然比标准少了1个字节的最大长度，但基本涵盖大部分字符（除了emoji等这种不常涉及的特殊字符）。

**所以选用 utf8 或是 utf8mb4 也是一个需要斟酌的优化点。**


## 比较规则解惑

使用MySQL很常见的操作就是排序，1、2、3这样的数字排序很好理解，若排序依赖的列是字符串形式的呢，比如 `varchar`，该怎么排呢，这就需要我们指定排序规则，也就是比较规则。

在MySQL中每个字符集都会有一堆比较规则，一一罗列我们这里就不进行了，下面我说几点规则（或者说注意点）：

1. 比较规则命名以 `_` 做含义分割，而不是驼峰法，比如 `utf8_general_ci`；
2. 比较规则的命名前缀代表字符集，比如 `utf8_general_ci` 就是一个 utf8 字符集的比较规则；
3. 比较规则的命名后缀也有讲究，如下：

| 后缀 | 含义 |
| --- | --- |
| _ai | 不区分重音 |
| _as | 区分重音 |
| _ci | 不区分大小写 |
| _as | 区分大小写 |
| _bin | 以二进制方式比较 |

4. 比较规则命名位于前缀和后缀中间的部分代表作用于哪种语言， `utf8_general_ci` 就是通用的，但 `utf8_polish_ci` 这种就支持波兰语了。


## 字符集和比较规则设置解惑

一般来说，我们在新建一个数据库的时候会指定字符集和比较规则，这并不是说是数据库本身用的，而是相当于设置的默认值。

再说到建表，也可以设置字符集和比较规则，但若是不设置，会默认使用建数据库时的默认值。

再说到建列（指字符串类型的），也可以设置字符集和比较规则，若不设置，默认使用列的。

也就是说，字符集和比较规则最终是具体到列用的，其并不是数据库统一或是表统一的。


## 参考

- [https://juejin.cn/book/6844733769996304392/section/6844733770042441741](https://juejin.cn/book/6844733769996304392/section/6844733770042441741)
